<!doctype html>
<html>
    <head>
        <title>Test d3.js</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
        <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='index.css') }}">
                <script src="https://d3js.org/d3.v4.min.js"></script>
    </head>
       

    <body>
        <div role="main">
            <div class="jumbotron">
                <h1>$tock $ystem</h1>   
            </div>
            <div class="container">
                              
            </div>
                <div class=''><h2>值Lee率 Ranking <3</h2></div>
                <div class="chart"></div>     
        </div>

        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>


    </body>
    
    <script>
        // Get data
        var req = new XMLHttpRequest();
        req.open('GET', 'http://127.0.0.1:5000/mysql', false);
        req.send( null );
        response = req.responseText;
        var jsonResponse = JSON.parse(response);
        var data = jsonResponse;
        
        // d3
        //
        /*
        d3.select('.chart')
            .selectAll('div')
            .data(jsonResponse)
            .enter()
            .append('div')
            .style('width', function(d) {return d['my']*30 + 'px';})
            .text(function(d){ return d['zh'] + ' ' + d['my'] + '%';})
            .style('font-size', function(){return '20px';});
        */
        /*
        var x = d3.scale.ordinal().rangeRoundBands([0, width], .05);
        var y = d3.scale.linear().range([height, 0]);
        var svg = d3.select("body").append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        */
    </script>
    <script>
        // set the dimensions and margins of the graph
        const margin = {top: 20, right: 20, bottom: 30, left: 40},
            width = 960 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;

        // set the ranges
        const x = d3.scaleBand()
                  .range([0, width])
                  .padding(0.1);
        const y = d3.scaleLinear()
                  .range([height, 0]);
                   
        // append the svg object to the body of the page
        // append a 'group' element to 'svg'
        // moves the 'group' element to the top left margin
        const svg = d3.select("body").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
          .append("g")
            .attr("transform", 
                  "translate(" + margin.left + "," + margin.top + ")");

        // get the data
        //d3.csv("file:///home/xero/Code/python/stock_front_end/templates/out.csv", function(error, data) {

          // format the data
            /*
          data.forEach(function(d) {
            d.sales = +d.sales;
          });*/
          //
          console.log(data)

          // Scale the range of the data in the domains
          x.domain(data.map(function(d) { return d.zh; }));
          y.domain([0, d3.max(data, function(d) { return d.my; })]);

          // append the rectangles for the bar chart
          svg.selectAll(".bar")
              .data(data)
            .enter().append("rect")
              .attr("class", "bar")
              .attr("x", function(d) { return x(d.zh); })
              .attr("width", x.bandwidth())
              .attr("y", function(d) { return y(d.my); })
              .attr("height", 0)
              .transition()
              .duration(200)
              .delay(function (d, i) {
                return i * 150;
              })
              .attr("height", function(d) { return height - y(d.my); });

          // add the x Axis
          svg.append("g")
              .attr("transform", "translate(0," + height + ")")
              .call(d3.axisBottom(x));

          // add the y Axis
          svg.append("g").call(d3.axisLeft(y));


    </script>
    
</html>
